<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org">

<div th:replace="fragments/menuTemplate :: menuHead"></div>

<body>
<div th:replace="fragments/menuTemplate :: menuBody"></div>

<div class="main-container">
    <div class="row m-0 bg-primary fixed-top myNav">
        <div class="col-md-6 border-bottom border-primary p-0 bg-primary d-flex justify-content-start align-items-center">
            <h3 class="fw-bold text-white mx-4 my-3">Reporte Contingentes</h3>
            <h5 class="fw-bold text-white mx-4 my-3" th:utext="'Periodo: '+${vFilter}"></h5>
        </div>
        <div class="col-md-6 d-flex align-items-center justify-content-end pe-5">
            <form class="form-inline" method="get" th:action="@{/reports/contingentes}">
                <div class="input-group">
                    <div class="input-group-append d-flex align-items-center">
                        <h5 class="me-2 mb-0">Fecha Consulta: </h5>
                        <input class="form-control" required th:name="period" th:value="${period}" type="month">
                        <button class="btn btn-secondary" type="submit"><i class="fa fa-search"></i></button>
                        <a class="btn btn-primary" th:href="@{/reports/contingentes?period={period}(period=${period})}"><i
                                class="fas fa-redo-alt"></i></a>
                    </div>
                </div>
            </form>
        </div>
    </div>
    <div id="content">
        <div class="row m-0 px-1 mt-5 align-items-center">
            <div class="row m-0 p-0 justify-content-between">
                <div class="col-md-6 d-block px-2">
                    <div class="col-sm-12 my-2 py-0 border">
                        <form class="d-flex flex-column " enctype="multipart/form-data" id="fileUploadForm"
                              method="post" th:action="@{/reports/contingentes}">
                            <div class="form-group my-2 d-flex align-items-center">
                                <label class="mb-0 mx-1 my-0">Carga Contingentes: </label>
                                <input accept=".xls,.xlsx,.xlsm" class="custom-file-control" id="file" multiple
                                       name="file"
                                       required type="file">
                                <button class="btn btn-sm btn-primary" type="submit">Cargar</button>
                            </div>
                            <div class="form-group mb-2 d-flex align-items-center">
                                <label class="mb-0 mx-1 my-0">Periodo: </label>
                                <input class="form-control-sm" required th:name="period" th:value="${period}"
                                       type="month">
                            </div>
                        </form>
                    </div>
                    <div class="col-md-12 my-2 py-0 border">
                        <form class="d-flex flex-column " enctype="multipart/form-data"
                              id="fileUploadFormContract"
                              method="post" th:action="@{/parametric/garantBank}">
                            <div class="form-group my-2 d-flex align-items-center">
                                <label class="mb-0 mx-1 my-0">Cargar Banco Garante: </label>
                                <input accept=".xls,.xlsx,.xlsm" class="custom-file-control" multiple name="file"
                                       required type="file">
                                <button class="btn btn-sm btn-primary" type="submit">Cargar</button>
                            </div>
                        </form>
                    </div>
                    <div class="col-auto my-2 py-1 border">
                        <a class="btn btn-sm btn-primary mx-1"
                           th:href="@{/reports/contingentes/uploadSicc?period={period}(period=${period})}">Cargar
                            información desde SICC</a>
                        <i class="fa fa-check-circle text-success mx-1" th:if="${validateSicc}"></i>
                        <i class="fa fa-times-circle text-danger mx-1" th:if="${!validateSicc}"></i>
                        <label class="mx-1" th:if="${validateSicc}" th:text="'Última carga el '+${dateSicc}"></label>
                        <label class="mx-1" th:if="${!validateSicc}">Sin cargar</label>
                    </div>
                    <div class="col-md-12 my-2 border">
                        <form method="get" th:action="@{/reports/contingentes/downloadArmado}">
                            <div class="row justify-content-center align-items-center">
                                <input required th:name="period" th:value="${period}" type="hidden">
                                <div class="col-sm-5 me-1 pt-1 mb-1">
                                    <div class="form-check">
                                        <input checked class="form-check-input" id="CmRec" th:name="CmRec"
                                               type="checkbox">
                                        <label class="form-check-label mx-1" for="CmRec">
                                            Reclasificación
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" id="CmRev" th:name="CmRev" type="checkbox">
                                        <label class="form-check-label mx-1" for="CmRev">
                                            Reversión
                                        </label>
                                    </div>
                                </div>
                                <div class="col-sm-5 me-1 pt-1 mb-1">
                                    <button class="btn btn-sm btn-primary" id="CmSubmit" type="submit">Generar y Descargar Carga
                                        Masiva
                                    </button>
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="col-md-12 my-2 border">
                        <div class="row justify-content-center">
                            <div class="col-md-4 mb-1 justify-content-center">
                                <a class="btn btn-sm btn-info mx-1"
                                   th:href="@{/reports/contingentes/sendIntergrupo?period={period}(period=${period})}"
                                   th:if="${statusComponent == false}">Confirmar
                                    y enviar a Intergrupo</a>
                                <button class="btn btn-sm btn-info mx-1" disabled th:if="${statusComponent}">
                                    Contingentes Confirmado
                                </button>
                            </div>
                            <div class="col-md-4 mb-1 justify-content-center">
                                <a class="btn btn-sm btn-primary mx-1"
                                   th:href="@{/reports/contingentes/downloadPlano?period={period}&extension=csv(period=${period})}">Plano
                                    de Reclasificación</a>
                            </div>
                            <div class="col-md-4 mb-1 justify-content-center">
                                <a class="btn btn-sm btn-primary mx-1"
                                   th:href="@{/reports/contingentes/downloadPlano?period={period}&extension=txt(period=${period})}">Plano
                                    CDD</a>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-5 d-block">
                    <!--<a class="btn btn-primary mx-1" th:href="@{/reports/rp21?period={period}(period=${period})}"><i class="fas fa-redo-alt"></i></a>
                    <span class="badge bg-primary">Validación sin diferencias</span>
                    -->
                    <div class="col-md-12 my-2 border">
                        <p class="fw-bold me-2 pt-2 mb-2 mb-0" th:if="${noQuery == false}">No hay Query Local cargado
                            para la fecha</p>
                        <form class="pt-2" method="get" th:action="@{/reports/contingentes/validateQuery}"
                              th:if="${noQuery}">
                            <input class="form-control w-25" required th:name="period" th:value="${period}"
                                   type="hidden">
                            <div class="row mb-1">
                                <label class="col-sm-5 col-form-label">Empresa Query Local:</label>
                                <div class="col-sm-5">
                                    <select class="form-control-sm form-select form-select-sm" id="company"
                                            required th:name="company" th:value="${company}">
                                        <option disabled hidden selected value="">Seleccione...</option>
                                        <option th:each="company : ${companies}" th:text="${company}"
                                                th:value="${company}"></option>
                                    </select>
                                </div>
                                <label class="col-sm-5 col-form-label">Inventario:</label>
                                <div class="col-sm-5">
                                    <select class="form-control-sm form-select form-select-sm" id="inventory"
                                            required th:name="inventory" th:value="${inventory}">
                                        <option disabled hidden selected value="">Seleccione...</option>
                                        <option>Sin Reclasificación</option>
                                        <option>Reclasificado</option>
                                    </select>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-sm-5 mb-3">
                                    <button class="btn btn-sm btn-primary" type="submit">Validar Query Tablon</button>
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="col-md-12 my-2 border">
                        <div class="row justify-content-center">
                            <div class="col-md-5 me-1 pt-1 mb-1 justify-content-center">
                                <label>Generación de COREP :</label>
                            </div>
                            <div class="col-md-5 me-1 pt-1 mb-1 justify-content-center">
                                <a class="btn btn-large btn-primary mx-1" data-toggle="modal" href="#exportModalCorep"
                                   role="button">COREP</a>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-12 my-2 border">
                        <p class="fw-bold me-2 pt-2 mb-2 mb-0" th:if="${noQueryIfrs == false}">No hay Query IFRS9
                            cargado para la fecha</p>
                        <form class="pt-2" method="get" th:action="@{/reports/contingentes/validateQueryIfrs}"
                              th:if="${noQueryIfrs}">
                            <input class="form-control w-25" required th:name="period" th:value="${period}"
                                   type="hidden">
                            <div class="row mb-1">
                                <label class="col-sm-5 col-form-label">Empresa Query IFRS9:</label>
                                <div class="col-sm-5">
                                    <select class="form-control-sm form-select form-select-sm" id="companyIfrs"
                                            required th:name="companyIfrs" th:value="${companyIfrs}">
                                        <option disabled hidden selected value="">Seleccione...</option>
                                        <option th:each="company : ${companiesIfrs}" th:text="${company}"
                                                th:value="${company}"></option>
                                    </select>
                                </div>
                                <!--<label class="col-sm-5 col-form-label">Inventario:</label>
                                <div class="col-sm-5">
                                  <select id="inventoryIfrs" class="form-control-sm form-select form-select-sm" th:name="inventoryIfrs" th:value="${inventoryIfrs}" required>
                                    <option disabled value="" selected hidden>Seleccione...</option>
                                    <option>COREP</option>
                                  </select>
                                </div>-->
                            </div>
                            <div class="row">
                                <div class="col-sm-5 mb-2">
                                    <button class="btn btn-sm btn-primary" type="submit">Validar Query COREP</button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        <div class="row m-0 px-1 mt-2">
            <div class="col-md-12">
                <div class="table table-sm table-responsive rounded border-primary">
                    <table cellspacing="0" class="table table-sm table-striped text-center table-bordered" id="example"
                           width="50%">
                        <thead class="bg-primary">
                        <tr>
                            <th>Cuenta Contable</th>
                            <th>NIT</th>
                            <th>Divisa</th>
                            <th>Saldo Pesos</th>
                            <th>Saldo Divisa</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:each="contigentes : ${allContingentes}">
                            <td th:text="${contigentes[0]}"></td>
                            <td th:text="${contigentes[1]}"></td>
                            <td th:text="${contigentes[2]}"></td>
                            <td th:text="${#numbers.formatDecimal(contigentes[3],1,'POINT',2,'COMMA')}"></td>
                            <td th:text="${#numbers.formatDecimal(contigentes[4],1,'POINT',2,'COMMA')}"></td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        <div class="row" th:if="${last != 0}">
            <div class="col-md-4 text-left">
                <nav arial-label="Pagination">
                    <ul class="pagination">
                        <li class="page-item" th:classappend="${prev == 0 ? 'disabled' : ''}">
                            <a class="page-link"
                               th:href="@{/reports/{dir}/?page={page}&vId={vId}&period={period}(period=${period},page=${prev},dir=${directory},vId=${vId})}">Anterior</a>
                        </li>
                        <li class="page-item" th:classappend="${current == last ? 'disabled' : ''}">
                            <a class="page-link"
                               th:href="@{/reports/{dir}/?page={page}&vId={vId}&period={period}(period=${period},page=${next},dir=${directory},vId=${vId})}">Siguiente</a>
                        </li>
                    </ul>
                </nav>
            </div>
            <div class="col-md-4 text-center">
                <h6 th:utext="${registers} + ' Registros Encontrados'"></h6>
            </div>
            <div class="col-md-4 text-right">
                <h6 class="mx-1" th:utext="'Página ' + ${current} + ' de ' + ${last}"></h6>
            </div>
        </div>
        <div class="pr-3 col-md-12 my-2">
            <div class="d-flex align-items-center justify-content-center">
                <a th:href="@{/reports/contingentes/download?period={period}(period=${period})}" class="btn btn-primary mx-1">Inventario Inicial</a>
                <a class="btn btn-primary mx-1"
                   th:href="@{/reports/contingentes/downloadInvenReclasificationCom?period={period}(period=${period})}">Exportar
                    Tablon</a>
                <a class="btn btn-primary"
                   th:href="@{/reports/contingentes/downloadReport?period={period}(period=${period})}">Exportar
                    Resumen</a>
            </div>
        </div>
        <div class="modal fade" id="exportModalCorep">
            <div class="modal-dialog rounded-1 modal-dialog-centered">
                <div class="modal-content">
                    <form method="get" th:action="@{/reports/contingentes/downloadCOREP}">
                        <div class="modal-header bg-primary text-light">
                            <h4 class="modal-title">Sección documento COREP</h4>
                            <button aria-hidden="true" class="close" data-dismiss="modal" type="button">&times;</button>
                        </div>
                        <div class="modal-body">
                            <input class="form-control" required th:name="period" th:value="${period}" type="hidden">
                            <div class="row px-3">
                                <div class="form-group">
                                    <label for="omitir">Ingrese el listado de cuentas nivel 1 a excluir en la generación
                                        del documento COREP haciendo la separación de las cuentas por el delimitador
                                        Coma (,)</label>
                                    <input class="form-control" id="omitir" placeholder="Ejem -> 8,7,3" required
                                           th:name="omitir" type="text">
                                </div>
                                <div class="form-group">
                                    <label>Ingrese el listado de cuentas nivel 4 a incluir en la generación del
                                        documento COREP haciendo la separación de las cuentas por el delimitador Coma
                                        (,)</label>
                                    <br/>
                                    <label for="incluirP">Provisiones: </label>
                                    <input class="form-control" id="incluirP" placeholder="Ejem -> 2384" required
                                           th:name="incluirP" type="text">
                                    <label for="incluirR">Riesgos: </label>
                                    <input class="form-control" id="incluirR" placeholder="Ejem -> 3849,4938" required
                                           th:name="incluirR" type="text">
                                </div>
                                <div class="form-group">
                                    <label>Ingrese el listado de códigos de liquidez que se marcaran como "INSTITUCIÓN"
                                        en la generación del documento COREP haciendo la separación por el delimitador
                                        Coma (,) y a nivel de 3 relleno de ceros a la izquierda (000)</label>
                                    <br/>
                                    <label for="tcliente">Códigos: </label>
                                    <input class="form-control" id="tcliente" placeholder="Ejem -> 003, 001" required
                                           th:name="tcliente" type="text">
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer d-flex justify-content-center">
                            <button class="btn btn-primary" type="submit">Exportar COREP</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
<!--<script src="http://ajax.aspnetcdn.com/ajax/jQuery/jquery-2.0.3.min.js"></script>
<script crossorigin="anonymous"
        integrity="sha384-cs/chFZiN24E4KMATLdqdvsezGxaGsi4hLGOzlXwp5UZB1LY//20VyM2taTB4QvJ"
        src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js"></script>
<script crossorigin="anonymous"
        integrity="sha384-uefMccjFJAIv6A+rW+L4AHf99KvxDjWSu1z9VI8SKNVmz4sk7buKt/6v9KI65qnm"
        src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"></script>-->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.3/dist/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
<script type="text/javascript">
    var queryString = window.location.search;
    var urlParams = new URLSearchParams(queryString);
    var respuesta = urlParams.get('resp');
    var row = urlParams.get('row');
    var column = urlParams.get('colum');
    validateAlerts(respuesta, row, column);
    $(document).ready(function () {
        $('#sidebarCollapse').on('click', function () {
            $('#sidebar').toggleClass('active');
        });
    });

    const selectElement = document.getElementById("CmRec");
    const selectElement2 = document.getElementById("CmRev");
    const selectElement3 = document.getElementById("CmSubmit");

    selectElement.addEventListener('change', (event) => {
        if (selectElement2.checked == true || selectElement.checked == true) {
            selectElement3.disabled = false;
        } else {
            selectElement3.disabled = true;
        }
    });

    selectElement2.addEventListener('change', (event) => {
        if (selectElement2.checked == true || selectElement.checked == true) {
            selectElement3.disabled = false;
        } else {
            selectElement3.disabled = true;
        }
    });
</script>
</body>

</html>